{% extends "base.html" %}

{% load static wagtailuserbar wagtailcore_tags wagtailimages_tags navigation_tags util_tags %}
{% wagtail_site as current_site %}

{% block meta_tags %}
    {% if GOOGLE_TAG_MANAGER_ID and not request.in_preview_panel and not is_pattern_library %}
        {# To enable GTM code you need to specify GOOGLE_TAG_MANAGER_ID in Django settings #}
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                                                      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','{{ GOOGLE_TAG_MANAGER_ID|escapejs }}');</script>
    {% endif %}

    {# favicons #}
    <link rel="shortcut icon" sizes="16x16 32x32 48x48" href="/favicon.ico" type="image/x-icon" />

    {% comment %}
        Twitter summary card - see https://dev.twitter.com/cards/types/summary
        and https://dev.twitter.com/cards/getting-started
    {% endcomment %}
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@{{ settings.core.SocialMediaSettings.twitter_handle }}" />
    <meta name="twitter:title" content="{{ page.title }}" />
    <meta name="twitter:description" content="{{ page|social_text:current_site }}">
    {% with social_image=page|social_image:current_site %}
        {% if social_image  %}
            {% image social_image width-1000 as twitter_img %}
            {# This will give a full path to the image when on staging or production because S3 storage is used. If testing locally, make sure you use the default localhost:8000 url. Testing via :3000 will give peculiar results. #}
            <meta name="twitter:image" content="{{ twitter_img.url }}">
            {% if twitter_img.alt %}
                <meta name="twitter:image:alt" content="{{ twitter_img.alt }}">
            {% endif %}
            {% image social_image fill-1200x630-c100 as og_img %}
            {# This will give a full path to the image when on staging or production because S3 storage is used. If testing locally, make sure you use the default localhost:8000 url. Testing via :3000 will give peculiar results. #}
            <meta property="og:image" content="{{ og_img.url }}" />
            <meta property="og:image:width" content="{{ og_img.width }}" />
            <meta property="og:image:height" content="{{ og_img.height }}" />
        {% else %}
            {% comment %}
            An example of how to add a default image to use for social sharing in case one is not provided on the page.
            Note that you need to explicitly add the root url here as the static path will not include it
            <meta name="twitter:image" content="{{ current_site.root_url }}{% static 'images/social-image.png' %}">
            {% endcomment %}
        {% endif %}
    {% endwith %}
    <meta property="og:type" content="website" />
    <meta property="og:url" content="{{ site.root_url }}{{ page.url }}" />
    <meta property="og:title" content="{{ page.title }}" />
    <meta property="og:description" content="{{ page|social_text:current_site }}" />
    <meta property="og:site_name" content="{{ settings.core.SocialMediaSettings.site_name }}" />
    {# facebook opengraph tags #}
    {% if settings.core.SocialMediaSettings.facebook_app_id %}
        <meta property="fb:app_id" content="{{ settings.core.SocialMediaSettings.facebook_app_id }}" />
    {% endif %}
{% endblock meta_tags %}


{% block body_top %}
    {% if GOOGLE_TAG_MANAGER_ID and not request.in_preview_panel and not is_pattern_library %}
        {# To enable GTM code you need to specify GOOGLE_TAG_MANAGER_ID in Django settings #}
        <noscript><iframe src="https://www.googletagmanager.com/ns.html?id={{ GOOGLE_TAG_MANAGER_ID|urlencode }}"
                          height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    {% endif %}
{% endblock body_top %}


{% block header %}
    {% include "components/skip_link/skip_link.html" %}
    {% include "components/header/header.html" %}
    {% include "components/alert_banner/alert_banner.html" %}
{% endblock header %}

{% block footer %}
    {% include "components/footer/footer.html" %}
{% endblock footer %}
